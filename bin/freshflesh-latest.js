/* v0.3_alpha */
var FF={};FF.TextureCache=[];FF.TMXMapCache=[];FF.BitmapFontCache=[];FF.AudioCache=[];FF.Render={};FF.CanvasRender=function(a){this.canvas=null;this.width=0;this.height=0};FF.CanvasRender.prototype.createRender=function(a){var b;var c=this;if(a){b=a}else{b=document.createElement("canvas");b.style.position="absolute";b.style.top="0px";b.style.left="0px";b.width=FF.Util.screenWidth();b.height=FF.Util.screenHeight();document.body.appendChild(b)}this.width=b.width;this.height=b.height;window.addEventListener("resize",function(f){var d=FF.Util.screenSize();b.width=d.width;c.width=d.width;b.height=d.height;c.height=d.height});this.canvas=b};FF.CanvasRender.prototype.getContext=function(){return this.canvas.getContext("2d")};FF.CanvasRender.prototype.getWidth=function(){return this.width};FF.CanvasRender.prototype.getHeight=function(){return this.height};FF.CanvasRender.prototype.setBackgroundColor=function(a){if(a=="#FFF"&&a=="#FFFFFF"){return}this.getContext().save();this.getContext().fillStyle=a;this.getContext().fillRect(0,0,this.getContext().canvas.width,this.getContext().canvas.height);this.getContext().restore()};FF.CanvasRender.prototype.clearRect=function(a,d,b,c){this.getContext().clearRect(a,d,b,c)};FF.CanvasRender.prototype.save=function(){this.getContext().save()};FF.CanvasRender.prototype.restore=function(){this.getContext().restore()};FF.CanvasRender.prototype.translate=function(a,b){this.getContext().translate(a,b)};FF.CanvasRender.prototype.rotate=function(a){this.getContext().rotate(a)};FF.CanvasRender.prototype.setAlpha=function(a){this.getContext().globalAlpha=a};FF.CanvasRender.prototype.drawImage=function(c,a,e,b,d){this.getContext().drawImage(c,a,e,b,d)};FF.CanvasRender.prototype.drawSubImage=function(a,f,e,k,c,g,d,j,b){this.getContext().drawImage(a,f,e,k,c,g,d,j,b)};FF.CanvasRender.prototype.fillRect=function(d,a,e,b,c){this.getContext().save();this.getContext().fillStyle=d;this.getContext().fillRect(a,e,b,c);this.getContext().restore()};FF.CanvasRender.prototype.fillText=function(d,b,c,a,e){this.getContext().save();this.getContext().font=b;this.getContext().fillStyle=c;this.getContext().fillText(d,a,e);this.getContext().restore()};FF.CanvasRender.prototype.fillTextWithShadow=function(f,c,a,h,g,j,e,b,d){this.getContext().save();this.getContext().font=c;this.getContext().fillStyle=a;this.getContext().shadowColor=j;this.getContext().shadowBlur=d;this.getContext().shadowOffsetX=e;this.getContext().shadowOffsetY=b;this.getContext().fillText(f,h,g);this.getContext().restore()};FF.CanvasRender.prototype.measureText=function(a,c){this.getContext().save();this.getContext().font=a;var b=this.getContext().measureText(c);this.getContext().restore();return b};FF.CanvasRender.prototype.clip=function(){return this.getContext().clip()};FF.CanvasRender.prototype.beginPath=function(){return this.getContext().beginPath()};FF.CanvasRender.prototype.arc=function(f,e,a,c,b,d){return this.getContext().arc(f,e,a,c,b,d)};FF.CanvasRender.prototype.rect=function(b,d,c,a){return this.getContext().rect(b,d,c,a)};FF.WebGLRender=function(a){console.log("Using webgl");this.canvas=null;this.width=0;this.height=0};FF.WebGLRender.prototype.createRender=function(a){var b,c=this;if(a){b=a}else{b=document.createElement("canvas");b.style.position="absolute";b.style.top="0px";b.style.left="0px";b.width=FF.Util.screenWidth();b.height=FF.Util.screenHeight();document.body.appendChild(b)}this.width=b.width;this.height=b.height;window.addEventListener("resize",function(f){var d=FF.Util.screenSize();b.width=d.width;c.width=d.width;b.height=d.height;c.height=d.height});this.canvas=b;WebGL2D.enable(this.canvas)};FF.WebGLRender.prototype.getContext=function(){return this.canvas.getContext("webgl-2d")};FF.WebGLRender.prototype.getWidth=function(){return this.width};FF.WebGLRender.prototype.getHeight=function(){return this.height};FF.WebGLRender.prototype.setBackgroundColor=function(a){this.getContext().save();this.getContext().fillStyle=a;this.getContext().fillRect(0,0,this.getContext().canvas.width,this.getContext().canvas.height);this.getContext().restore()};FF.WebGLRender.prototype.clearRect=function(a,d,b,c){this.getContext().clearRect(a,d,b,c)};FF.WebGLRender.prototype.save=function(){this.getContext().save()};FF.WebGLRender.prototype.restore=function(){this.getContext().restore()};FF.WebGLRender.prototype.translate=function(a,b){this.getContext().translate(a,b)};FF.WebGLRender.prototype.rotate=function(a){this.getContext().rotate(a)};FF.WebGLRender.prototype.setAlpha=function(a){this.getContext().globalAlpha=a};FF.WebGLRender.prototype.drawImage=function(c,a,e,b,d){this.getContext().drawImage(c,a,e,b,d)};FF.WebGLRender.prototype.drawSubImage=function(a,f,e,k,c,g,d,j,b){this.getContext().drawImage(a,f,e,k,c,g,d,j,b)};FF.WebGLRender.prototype.fillRect=function(d,a,e,b,c){this.getContext().save();this.getContext().fillStyle=d;this.getContext().fillRect(a,e,b,c);this.getContext().restore()};FF.WebGLRender.prototype.fillText=function(d,b,c,a,e){this.getContext().save();this.getContext().font=b;this.getContext().fillStyle=c;this.getContext().fillText(d,a,e);this.getContext().restore()};FF.WebGLRender.prototype.fillTextWithShadow=function(f,c,a,h,g,j,e,b,d){this.getContext().save();this.getContext().font=c;this.getContext().fillStyle=a;this.getContext().shadowColor=j;this.getContext().shadowBlur=d;this.getContext().shadowOffsetX=e;this.getContext().shadowOffsetY=b;this.getContext().fillText(f,h,g);this.getContext().restore()};FF.WebGLRender.prototype.measureText=function(a,c){this.getContext().save();this.getContext().font=a;var b=this.getContext().measureText(c);this.getContext().restore();return b};FF.WebGLRender.prototype.clip=function(){return this.getContext().clip()};FF.WebGLRender.prototype.beginPath=function(){return this.getContext().beginPath()};FF.WebGLRender.prototype.arc=function(f,e,a,c,b,d){return this.getContext().arc(f,e,a,c,b,d)};FF.WebGLRender.prototype.rect=function(b,d,c,a){return this.getContext().rect(b,d,c,a)};FF.ImageLoader=function(a){FF.EventManager.call(this);this.imageUrl=a};FF.ImageLoader.prototype.load=function(){var b=this;var a=new Image();a.src=this.imageUrl;a.onload=function(c){b.dispatchEvent({type:"loaded"})};FF.TextureCache[this.imageUrl]=a};FF.BitmapFontLoader=function(a){FF.EventManager.call(this);this.url=a};FF.BitmapFontLoader.prototype.load=function(){var b=this.url.split(".").pop().toLowerCase();if(b!="fnt"){throw new Error("[FF.BitmapFontLoader] File type ("+b+") is not supported")}var a=this.fromFNT()};FF.BitmapFontLoader.prototype.fromFNT=function(){var a=this;FF.Util.ajax({type:"POST",url:this.url,complete:function(j){var o=FF.Util.getDOMDocument(j);var h=o.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue;var d={};var c=o.getElementsByTagName("info")[0];var k=o.getElementsByTagName("common")[0];d.font=c.attributes.getNamedItem("face").nodeValue;d.size=parseInt(c.attributes.getNamedItem("size").nodeValue,10);d.lineHeight=parseInt(k.attributes.getNamedItem("lineHeight").nodeValue,10);d.chars={};d.texture=h;var m=o.getElementsByTagName("char");for(var e=0;e<m.length;e++){var q=parseInt(m[e].attributes.getNamedItem("id").nodeValue,10);var p={x:parseInt(m[e].attributes.getNamedItem("x").nodeValue,10),y:parseInt(m[e].attributes.getNamedItem("y").nodeValue,10),width:parseInt(m[e].attributes.getNamedItem("width").nodeValue,10),height:parseInt(m[e].attributes.getNamedItem("height").nodeValue,10)};d.chars[q]={xOffset:parseInt(m[e].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(m[e].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(m[e].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},textureRect:p}}var n=o.getElementsByTagName("kerning");for(e=0;e<n.length;e++){var g=parseInt(n[e].attributes.getNamedItem("first").nodeValue,10);var b=parseInt(n[e].attributes.getNamedItem("second").nodeValue,10);var f=parseInt(n[e].attributes.getNamedItem("amount").nodeValue,10);d.chars[b].kerning[g]=f}FF.BitmapFontCache[d.font]=d;image=new FF.ImageLoader(h);image.addEventListener("loaded",function(){d.texture=FF.TextureCache[h];a.onLoaded()});image.load()}})};FF.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};FF.AudioLoader=function(a){FF.EventManager.call(this);this.soundUrl=a};FF.AudioLoader.prototype.load=function(){var a=this;var b=new Audio(this.soundUrl);b.oncanplaythrough=function(c){a.dispatchEvent({type:"loaded"})};b.load();FF.AudioCache[this.soundUrl]=b};FF.TMXLoader=function(a){FF.EventManager.call(this);this.mapUrl=a};FF.TMXLoader.prototype.load=function(){this.fromTMX()};FF.TMXLoader.prototype.fromJSON=function(){};FF.TMXLoader.prototype.fromTMX=function(){var a=this;FF.Util.ajax({type:"POST",url:this.mapUrl,complete:function(q){var G=FF.Util.getDOMDocument(q);var o={width:0,height:0,tilewidth:0,tileheight:0,obj_groups:[],layers:[],tilesets:[],orientation:"",properties:{},version:0};o.width=parseInt(G.getElementsByTagName("map")[0].getAttribute("width"));o.height=parseInt(G.getElementsByTagName("map")[0].getAttribute("height"));o.tilewidth=parseInt(G.getElementsByTagName("map")[0].getAttribute("tilewidth"));o.tileheight=parseInt(G.getElementsByTagName("map")[0].getAttribute("tileheight"));o.version=parseInt(G.getElementsByTagName("map")[0].getAttribute("version"));try{var c=G.getElementsByTagName("map")[0].getElementsByTagName("properties")[0].getElementsByTagName("property");for(var r=0;r<c.length;r++){o.properties[c[r].getAttribute("name")]=c[r].getAttribute("value")}}catch(B){}var s=G.getElementsByTagName("map")[0].getElementsByTagName("tileset");for(var v=0;v<s.length;v++){var n={firstgid:parseInt(s[v].getAttribute("firstgid")),positions:[],name:s[v].getAttribute("name"),image:(s[v].getElementsByTagName("image")[0].getAttribute("source")).split("../").pop(),imagewidth:parseInt(s[v].getElementsByTagName("image")[0].getAttribute("width")),imageheight:parseInt(s[v].getElementsByTagName("image")[0].getAttribute("height")),margin:0,spacing:0,properties:{},tilewidth:parseInt(s[v].getAttribute("tilewidth")),tileheight:parseInt(s[v].getAttribute("tileheight"))};var f=1;for(var u=0;u<n.imageheight;u+=n.tileheight){for(var w=0;w<n.imagewidth;w+=n.tilewidth){n.positions[f]={x:w,y:u};f++}}o.tilesets[v]=n}var d=G.getElementsByTagName("map")[0].getElementsByTagName("layer");for(var v=0;v<d.length;v++){var F={name:d[v].getAttribute("name"),x:0,y:0,width:parseInt(d[v].getAttribute("width")),height:parseInt(d[v].getAttribute("height")),opacity:1,type:"tilelayer",visible:true,properties:{},data:[]};try{var c=d[v].getElementsByTagName("properties")[0].getElementsByTagName("property");for(var r=0;r<c.length;r++){F.properties[c[r].getAttribute("name")]=c[r].getAttribute("value")}}catch(B){}var C=d[v].getElementsByTagName("tile");var f=0;for(var h=0;h<F.width;h++){var A=[];for(var g=0;g<F.height;g++){A[g]=C[(h+(g*F.width))].getAttribute("gid");f++}F.data[h]=A}o.layers[v]=F}var p=G.getElementsByTagName("map")[0].getElementsByTagName("objectgroup");for(var v=0;v<p.length;v++){var D={name:p[v].getAttribute("name"),width:parseInt(p[v].getAttribute("width")),height:parseInt(p[v].getAttribute("height")),objects:[],properties:{}};try{var c=p[v].getElementsByTagName("properties")[0].getElementsByTagName("property");for(var r=0;r<c.length;r++){D.properties[c[r].getAttribute("name")]=c[r].getAttribute("value")}}catch(B){}var b=p[v].getElementsByTagName("object");for(var t=0;t<b.length;t++){var E={gid:parseInt(b[t].getAttribute("gid")),x:parseInt(b[t].getAttribute("x")),y:parseInt(b[t].getAttribute("y"))-((b[t].getAttribute("gid"))?o.tileheight:0),width:(b[t].getAttribute("width"))?parseInt(b[t].getAttribute("width")):o.tilewidth,height:(b[t].getAttribute("height"))?parseInt(b[t].getAttribute("height")):o.tileheight,rect:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},type:b[t].getAttribute("type"),properties:{}};try{var c=b[t].getElementsByTagName("properties")[0].getElementsByTagName("property");for(var r=0;r<c.length;r++){E.properties[c[r].getAttribute("name")]=c[r].getAttribute("value")}}catch(B){}D.objects.push(E)}o.obj_groups.push(D)}FF.TMXMapCache[a.mapUrl]=o;a.dispatchEvent({type:"loaded"})}})};FF.AssetLoader=function(a){FF.EventManager.call(this);this.assetsURL=a;this.loadedCount=0;this.assetsTypes={jpg:FF.ImageLoader,jpeg:FF.ImageLoader,gif:FF.ImageLoader,png:FF.ImageLoader,tmx:FF.TMXLoader,fnt:FF.BitmapFontLoader,json:FF.TMXLoader,mp3:FF.AudioLoader}};FF.AssetLoader.prototype.load=function(){var d=this;for(i in this.assetsURL){var b=this.assetsURL[i];var c=this.assetsURL[i].split(".").pop().toLowerCase();var a=this.assetsTypes[c];if(!a){throw new Error("Filetype of ["+b+"] is not supported")}a=new a(b);a.addEventListener("loaded",function(){d.loadedAsset(b)});a.load()}};FF.AssetLoader.prototype.loadedAsset=function(a){var b=this;this.loadedCount++;this.dispatchEvent({type:"progress",loaded:b.loadedCount,total:b.assetsURL.length,currentFile:a});if(this.loadedCount==this.assetsURL.length){this.dispatchEvent({type:"loaded"})}};FF.Sprite=function(a){if(!a.image){throw new Error("[FF.Sprite] You have to provide at least the image path for your sprite")}if(FF.TextureCache[a.image]===undefined){throw new Error("[FF.Sprite] You are using a non-loaded asset")}FF.EventManager.call(this);this.image=FF.TextureCache[a.image];this.originalWidth=this.image.width;this.originalHeight=this.image.height;this.x=a.x||0;this.y=a.y||0;this.scale=((a.fitRenderHeight)?Math.ceil(FF.Render.getHeight()/this.originalHeight):a.scale)||1;this.rotate=a.rotate||0;this.roundClip=a.roundClip||false;this.rectClip=a.rectClip||false;this.anchor=a.anchor||[0,0];this.alpha=a.alpha||1;this.hidden=a.hidden||false;this.hover=false};FF.Sprite.prototype.rect=function(){return{x:this.x,y:this.y,width:this.originalWidth*this.scale,height:this.originalHeight*this.scale}};FF.Sprite.prototype.center=function(){return{x:this.x+((this.originalWidth*this.scale)/2),y:this.y+((this.originalHeight*this.scale)/2)}};FF.Sprite.prototype.update=function(){if(FF.InputManager.mouse_x>=this.x&&FF.InputManager.mouse_x<=this.x+this.rect().width&&FF.InputManager.mouse_y>=this.y&&FF.InputManager.mouse_y<=this.y+this.rect().height){if(FF.InputManager.pressedWithoutRepeat(["left_mouse_button"])){this.dispatchEvent({type:"click"})}this.hover=true;if(this.hidden==false){this.dispatchEvent({type:"mouseover"})}}else{if(this.hover==true&&this.hidden==false){this.dispatchEvent({type:"mouseout"})}this.hover=false}};FF.Sprite.prototype.draw=function(){if(this.hidden){return}FF.Render.save();FF.Render.setAlpha(this.alpha);if(this.roundClip!=false){FF.Render.beginPath();FF.Render.arc(this.roundClip.x+(this.roundClip.width/2),this.roundClip.y+(this.roundClip.height/2),this.roundClip.width/2,0,Math.PI*2,false);FF.Render.clip()}if(this.rectClip!=false){FF.Render.beginPath();FF.Render.rect(this.rectClip.x,this.rectClip.y,this.rectClip.width,this.rectClip.height);FF.Render.clip()}FF.Render.translate(this.rect().x+this.anchor[0],this.rect().y+this.anchor[1]);if(this.lastRotate&&this.lastRotate!=this.rotate){this.dispatchEvent({type:"rotate",angle:this.rotate-this.lastRotate})}FF.Render.rotate(this.rotate*Math.PI/180);FF.Render.translate(-(this.rect().x+this.anchor[0]),-(this.rect().y+this.anchor[1]));this.lastRotate=this.rotate;FF.Render.drawImage(this.image,this.x,this.y,this.originalWidth*this.scale,this.originalHeight*this.scale);FF.Render.restore()};FF.Sprite.prototype.switchImage=function(a){if(!a){throw new Error("[FF.Sprite] You have to provide the image path of your sprite")}if(FF.TextureCache[a]===undefined){throw new Error("[FF.Sprite] You are using a non-loaded asset")}this.image=FF.TextureCache[a]};FF.SpriteSheet=function(b){if(!b.image){throw new Error("[FF.SpriteSheet] You have to provide at least the image path for your sprite")}if(FF.TextureCache[b.image]===undefined){throw new Error("[FF.SpriteSheet] You are using a non-loaded asset")}FF.EventManager.call(this);this.image=FF.TextureCache[b.image];this.originalWidth=this.image.width;this.frameWidth=b.frame_size[0]||this.image.width;this.originalHeight=this.image.height;this.frameHeight=b.frame_size[1]||this.image.height;this.x=b.x||0;this.y=b.y||0;this.scale=b.scale||1;this.alpha=b.alpha||1;this.hidden=b.hidden||false;this.bounds=b.bounds||[0,0,this.frameWidth,this.frameHeight];this.hover=false;this.currentGID=0;this.frames=[];this.positions=[];var c=0;for(var a=0;a<this.originalHeight;a+=this.frameHeight){for(var d=0;d<this.originalWidth;d+=this.frameWidth){this.frames.push(c);this.positions[c]={x:d,y:a};c++}}};FF.SpriteSheet.prototype.rect=function(){return{x:this.x,y:this.y,width:this.bounds[2]*this.scale,height:this.bounds[3]*this.scale}};FF.SpriteSheet.prototype.update=function(){if(FF.InputManager.mouse_x>=this.x&&FF.InputManager.mouse_x<=this.x+this.rect().width&&FF.InputManager.mouse_y>=this.y&&FF.InputManager.mouse_y<=this.y+this.rect().height){if(FF.InputManager.pressedWithoutRepeat(["left_mouse_button"])){this.dispatchEvent({type:"click"})}this.hover=true;if(this.hidden==false){this.dispatchEvent({type:"mouseover"})}}else{if(this.hover==true&&this.hidden==false){this.dispatchEvent({type:"mouseout"})}this.hover=false}};FF.SpriteSheet.prototype.draw=function(){if(this.hidden){return}var a=this.positions[this.currentGID];FF.Render.save();FF.Render.setAlpha(this.alpha);FF.Render.drawSubImage(this.image,a.x,a.y,this.frameWidth*this.scale,this.frameHeight*this.scale,this.x-this.bounds[0],this.y-this.bounds[1],this.frameWidth*this.scale,this.frameHeight*this.scale);FF.Render.restore()};FF.SpriteSheet.prototype.switchImage=function(a){if(!a){throw new Error("[FF.SpriteSheet] You have to provide the image path of your sprite")}if(FF.TextureCache[a]===undefined){throw new Error("[FF.SpriteSheet] You are using a non-loaded asset")}this.image=FF.TextureCache[a]};FF.SpriteSheet.prototype.setFrame=function(a){this.currentGID=a};FF.Parallax=function(a){FF.EventManager.call(this);this.width=a.width||FF.Render.getWidth();this.height=a.height||FF.Render.getHeight();this.x=a.x||0;this.y=a.y||0;this.repeat_x=a.repeat_x||true;this.repeat_y=a.repeat_y||false;this.camera_x=a.camera_x||0;this.camera_y=a.camera_y||0;this.layers=a.layers||[]};FF.Parallax.addLayer=function(a){this.layers.push(a)};FF.Parallax.prototype.draw=function(){for(var e=0;e<this.layers.length;e++){var d,c,b,a;d=this.layers[e];if(this.repeat_x){a=-((this.camera_x/d.speed)%d.sprite.rect().width)}else{a=-(this.camera_x/d.speed)}if(this.repeat_y){d.sprite.y=-((this.camera_y/d.speed)%d.sprite.rect().height)}else{d.sprite.y=-(this.camera_y/d.speed)}d.sprite.x=a;if(d.sprite.rect().x>0){d.sprite.x=0}while(d.sprite.y<this.height){while(d.sprite.rect().x<this.width){if(d.sprite.rect().x+d.sprite.rect().width>=0&&d.sprite.rect().y+d.sprite.rect().height>=0){d.sprite.draw()}d.sprite.x=d.sprite.rect().x+d.sprite.rect().width;if(!this.repeat_x){break}}d.sprite.y=d.sprite.rect().y+d.sprite.rect().height;d.sprite.x=a;if(!this.repeat_y){break}}}};FF.TiledMap=function(a){if(!a.map){throw new Error("[FF.TiledMap] You have to provide at least the path for your tiledmap")}if(FF.TMXMapCache[a.map]===undefined){throw new Error("[FF.TiledMap] You are using a non-loaded asset ("+a.map+")")}this.map=FF.TMXMapCache[a.map];this.x=a.x||0;this.y=a.y||0;this.alpha=a.alpha||1};FF.TiledMap.prototype.getTilesetNumber=function(b){var c=0;for(var a=0;a<this.map.tilesets.length;a++){if(this.map.tilesets[a+1]){if(b>=this.map.tilesets[a].firstgid&&b<this.map.tilesets[a+1].firstgid){c=a}else{c=a}}}return c};FF.TiledMap.prototype.drawImageFromGID=function(a,g,d,c){if(isNaN(d)){return}var b=this.getTilesetNumber(d);var f=this.map.tilesets[b];var e=f.positions[d];if(FF.TextureCache[f.image]===undefined){throw new Error("[FF.TiledMap.drawImageFromGID] You are using a non-loaded asset")}FF.Render.drawSubImage(FF.TextureCache[f.image],e.x,e.y,f.tilewidth,f.tileheight,(c=="object")?a:this.x+(a*f.tilewidth),(c=="object")?g:this.y+(g*f.tileheight),f.tilewidth,f.tileheight)};FF.TiledMap.prototype.drawRect=function(a){FF.Render.fillRect("rgba(255,0,0,0.5)",a.rect().x,a.rect().y,a.rect().width,a.rect().height)};FF.TiledMap.prototype.draw=function(){FF.Render.save();FF.Render.setAlpha(this.alpha);for(var a=0;a<this.map.layers.length;a++){var e=this.map.layers[a].data;if(!(e.properties&&e.properties.drawable&&e.properties.drawable=="false")){for(var d=0;d<e.length;d++){for(var c=0;c<e[d].length;c++){if(e[d][c]!=0){this.drawImageFromGID(d,c,e[d][c],"tile")}}}}}for(var f=0;f<this.map.obj_groups.length;f++){var h=this.map.obj_groups[f];if(!(h.properties&&h.properties.drawable&&h.properties.drawable=="false")){for(var k=0;k<h.objects.length;k++){var b=h.objects[k];if(!isNaN(b.gid)){this.drawImageFromGID(b.x,b.y,b.gid,"object")}}}}FF.Render.restore()};FF.TiledMap.prototype.drawLayer=function(e){FF.Render.save();FF.Render.setAlpha(this.alpha);for(var a=0;a<this.map.layers.length;a++){var d=this.map.layers[a].data;if(this.map.layers[a].name==e){for(var c=0;c<d.length;c++){for(var b=0;b<d[c].length;b++){if(d[c][b]!=0){this.drawImageFromGID(c,b,d[c][b],"tile")}}}}}FF.Render.restore()};FF.TiledMap.prototype.drawEveryLayerBut=function(e){FF.Render.save();FF.Render.setAlpha(this.alpha);for(var a=0;a<this.map.layers.length;a++){var d=this.map.layers[a].data;if(d.name!=e){for(var c=0;c<d.length;c++){for(var b=0;b<d[c].length;b++){if(d[c][b]!=0){this.drawImageFromGID(c,b,d[c][b],"tile")}}}}}FF.Render.restore()};FF.TiledMap.prototype.drawObjectGroup=function(e){FF.Render.save();FF.Render.setAlpha(this.alpha);for(var b=0;b<this.map.obj_groups.length;b++){var c=this.map.obj_groups[b];if(c.name==e){for(var d=0;d<c.objects.length;d++){var a=c.objects[d];this.drawImageFromGID(a.x,a.y,a.gid,"object")}}}FF.Render.restore()};FF.TiledMap.prototype.drawEveryObjectGroups=function(){FF.Render.save();FF.Render.setAlpha(this.alpha);for(var b=0;b<this.map.obj_groups.length;b++){var c=this.map.obj_groups[b];for(var d=0;d<c.objects.length;d++){var a=c.objects[d];this.drawImageFromGID(a.x,a.y,a.gid,"object")}}FF.Render.restore()};FF.TiledMap.prototype.rect=function(){return{x:this.x,y:this.y,width:this.map.width*this.map.tilewidth,height:this.map.height*this.map.tileheight}};FF.TiledMap.prototype.getRectFromTile=function(a,f,c){var d=this;var b=this.getTilesetNumber(c);var e=this.map.tilesets[b];return{rect:function(){return{x:d.x+(a*e.tilewidth),y:d.y+(f*e.tileheight),width:e.tilewidth,height:e.tileheight}}}};FF.TiledMap.prototype.foreach=function(d){l=1;var c=this.map.layers[l].data;for(var b in c){for(var a in c[b]){if(c[b][a]!=0){d(this.getRectFromTile(b,a,c[b][a]))}}}};FF.TiledMap.prototype.atRect=function(j){var k=[];var h;var f=parseInt(j.x/this.map.tilewidth);if(f<0){f=0}var d=parseInt((j.x+j.width)/this.map.tilewidth);if(d>=this.map.width){d=this.map.width-1}var e=parseInt(j.y/this.map.tileheight);if(e<0){e=0}var a=parseInt((j.y+j.height)/this.map.tileheight);if(a>=this.map.height){a=this.map.height-1}for(var b=f;b<=d;b++){for(var m=e;m<=a;m++){for(var c=0;c<this.map.layers.length;c++){if(this.map.layers[c].properties.blocant&&this.map.layers[c].properties.blocant=="true"){var g=this.map.layers[c].data[b][m];if(g!=0&&k.indexOf(this.getRectFromTile(b,m,g))==-1){k.push(this.getRectFromTile(b,m,g))}}}}}return k};FF.TiledMap.prototype.itemCollideWithSomethingInMap=function(b,a){if(a.obj_group){var d=this.getObjectGroup(a.obj_group);d=(d&&d.objects)?d.objects:[];return FF.Util.collideOneWithMany(b,d)}if(a.layer){var c=this.getLayer(a.layer);return FF.Util.collideOneWithMany(b,c)}};FF.TiledMap.prototype.removeObject=function(d,e){if(e){var c=this.getObjectGroup(e);var a=c.objects.indexOf(d);if(a!=-1){c.objects.splice(a,1)}}else{for(var b=0;b<this.map.obj_groups.length;b++){var c=this.map.obj_groups[b];var a=c.objects.indexOf(d);if(a!=-1){c.objects.splice(a,1);return}}}};FF.TiledMap.prototype.getObjectGroup=function(a){for(var b=0;b<this.map.obj_groups.length;b++){if(this.map.obj_groups[b].name==a){return this.map.obj_groups[b]}}};FF.TiledMap.prototype.getObjectFromPropertyValue=function(e,c,d,a){for(var b=0;b<e.length;b++){if(e[b].type==c){if(e[b].properties[d]&&e[b].properties[d]==a){return e[b]}}}};FF.TiledMap.prototype.getLayer=function(a){for(var b=0;b<this.map.layers.length;b++){if(this.map.layers[b].name==a){return this.map.layers[b]}}};FF.BitmapText=function(a){if(a.text===undefined||!a.fontFamily){throw new Error("[FF.BitmapText] You have to provide at least text & fontFamily for your bitmaptext")}if(!FF.BitmapFontCache[a.fontFamily]){throw new Error("[FF.BitmapText] You are using a non-loaded asset")}FF.EventManager.call(this);this.x=a.x||0;this.y=a.y||0;this.alpha=a.alpha||1;this.rotate=a.rotate||0;this.anchor=a.anchor||[0,0];this.text=""+a.text;this.align=a.align||"left";this.hidden=a.hidden||false;this.fontName=a.fontFamily;this.data=FF.BitmapFontCache[this.fontName];this.fontSize=a.fontSize||FF.BitmapFontCache[this.fontName].size;this.chars={};this.lineWidths=[];this.maxLineWidth=0;this.lineAlignOffsets=[];this.setup()};FF.BitmapText.prototype.rect=function(){return{x:this.x,y:this.y,width:this.maxLineWidth,height:this.lineWidths.length*this.data.lineHeight}};FF.BitmapText.prototype.setup=function(){this.chars={};this.lineWidths=[];this.maxLineWidth=0;this.lineAlighOffsets=[];var h={x:0,y:0};var g=null;var b=0;var f=this.fontSize/this.data.size;this.chars[b]=[];for(var e=0;e<this.text.length;e++){var a=this.text.charCodeAt(e);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(e))){this.chars[b]=[];this.lineWidths.push(h.x);this.maxLineWidth=Math.max(this.maxLineWidth,h.x);b++;h.x=0;h.y+=data.lineHeight*f;g=null;continue}var d=this.data.chars[a];if(!d){continue}if(g&&d[g]){h.x+=d.kerning[g]*f}this.chars[b].push({textureRect:d.textureRect,charCode:a,position:{x:h.x+d.xOffset*f,y:h.y+d.yOffset*f}});h.x+=d.xAdvance*f;g=a}this.lineWidths.push(h.x);this.maxLineWidth=Math.max(this.maxLineWidth,h.x);for(e=0;e<=b;e++){var c=0;if(this.align=="right"){c=this.maxLineWidth-this.lineWidths[e]}else{if(this.align=="center"){c=(this.maxLineWidth-this.lineWidths[e])/2}}this.lineAlignOffsets.push(c)}};FF.BitmapText.prototype.draw=function(){if(this.hidden){return}var d=this.fontSize/this.data.size;FF.Render.save();FF.Render.setAlpha(this.alpha);FF.Render.translate(this.rect().x+this.anchor[0],this.rect().y+this.anchor[1]);if(this.lastRotate&&this.lastRotate!=this.rotate){this.dispatchEvent({type:"rotate",angle:this.rotate-this.lastRotate})}FF.Render.rotate(this.rotate*Math.PI/180);FF.Render.translate(-(this.rect().x+this.anchor[0]),-(this.rect().y+this.anchor[1]));this.lastRotate=this.rotate;for(var a in this.chars){for(var b=0;b<this.chars[a].length;b++){var c=this.chars[a][b];FF.Render.drawSubImage(this.data.texture,c.textureRect.x,c.textureRect.y,c.textureRect.width,c.textureRect.height,this.x+c.position.x,this.y+c.position.y,c.textureRect.width*d,c.textureRect.height*d)}}FF.Render.restore()};FF.BitmapText.prototype.setText=function(a){this.text=""+a;this.setup()};FF.Music=function(a){if(!a.music){throw new Error("[FF.Music] You have to provide at least the file path for your music")}FF.EventManager.call(this);this.player=FF.AudioCache[a.music]||new Audio(a.music);this.player.load();this.player.loop=a.loop||false;this.player.autoplay=a.autoplay||false;this.player.volume=a.volume/100||1};FF.Music.prototype.play=function(){this.player.play()};FF.Music.prototype.pause=function(){this.player.pause()};FF.Music.prototype.moveTo=function(a){if(a>this.player.duration){return}this.player.currentTime=a};FF.Music.prototype.forward=function(a){if(this.player.currentTime+a>duration){return}this.player.currentTime+=a};FF.Music.prototype.backward=function(a){if(this.player.currentTime-a<duration){return}this.player.currentTime-=a};FF.Sound=function(a){if(!a.sound){throw new Error("[FF.Sound] You have to provide at least the file path for your sound")}if(FF.AudioCache[a.sound]===undefined){throw new Error("[FF.Sound] You are using a non-loaded asset")}FF.EventManager.call(this);this.player=FF.AudioCache[a.sound];this.player.loop=a.loop||false;this.player.autoplay=a.autoplay||false;this.player.volume=a.volume/100||1};FF.Sound.prototype.play=function(){var a=this.player.cloneNode();a.ontimeupdate=function(){if(this.currentTime>=this.duration){delete a}};a.play()};FF.Sound.prototype.pause=function(){this.player.pause()};FF.Sound.prototype.moveTo=function(a){if(a>this.player.duration){return}this.player.currentTime=a};FF.Sound.prototype.forward=function(a){if(this.player.currentTime+a>duration){return}this.player.currentTime+=a};FF.Sound.prototype.backward=function(a){if(this.player.currentTime-a<duration){return}this.player.currentTime-=a};var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(e,b){var a=new Date().getTime();var c=Math.max(0,16-(a-lastTime));var d=window.setTimeout(function(){e(a+c)},c);lastTime=a+c;return d}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(a){clearTimeout(a)}}(function(t,m){var A=3.141592653589793;var h=2*A;var z=A/2;function n(C){return C>0&&((C-1)&C)===0}var b={length:function(C){return t.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])},normalize:function(C){var D=t.sqrt((C[0]*C[0])+(C[1]*C[1])+(C[2]*C[2]));if(D===0){return[0,0,0]}return[C[0]/D,C[1]/D,C[2]/D]},dot:function(D,C){return D[0]*C[0]+D[1]*C[1]+D[2]*C[2]},angle:function(D,C){return t.acos((D[0]*C[0]+D[1]*C[1]+D[2]*C[2])/(t.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])*t.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])))},cross:function(D,C){return[D[1]*C[2]-C[1]*D[2],D[2]*C[0]-C[2]*D[0],D[0]*C[1]-C[0]*D[1]]},multiply:function(D,C){return[D[0]*C,D[1]*C,D[2]*C]},add:function(D,C){return[D[0]+C[0],D[1]+C[1],D[2]+C[2]]},subtract:function(D,C){return[D[0]-C[0],D[1]-C[1],D[2]-C[2]]},equal:function(D,C){var E=1e-7;if((D===m)&&(C===m)){return true}if((D===m)||(C===m)){return false}return(t.abs(D[0]-C[0])<E&&t.abs(D[1]-C[1])<E&&t.abs(D[2]-C[2])<E)}};var o={identity:[1,0,0,0,1,0,0,0,1],multiply:function(D,C){var V=D[0],U=D[1],T=D[2],S=D[3],R=D[4],Q=D[5],P=D[6],O=D[7],N=D[8],M=C[0],L=C[1],K=C[2],J=C[3],I=C[4],H=C[5],G=C[6],F=C[7],E=C[8];C[0]=M*V+J*U+G*T;C[1]=L*V+I*U+F*T;C[2]=K*V+H*U+E*T;C[3]=M*S+J*R+G*Q;C[4]=L*S+I*R+F*Q;C[5]=K*S+H*R+E*Q;C[6]=M*P+J*O+G*N;C[7]=L*P+I*O+F*N;C[8]=K*P+H*O+E*N},vec2_multiply:function(E,D){var C=[];C[0]=D[0]*E[0]+D[3]*E[1]+D[6];C[1]=D[1]*E[0]+D[4]*E[1]+D[7];return C},transpose:function(C){return[C[0],C[3],C[6],C[1],C[4],C[7],C[2],C[5],C[8]]}};function v(C){return this.clearStack(C)}var d=16;v.prototype.clearStack=function(C){this.m_stack=[];this.m_cache=[];this.c_stack=0;this.valid=0;this.result=null;for(var D=0;D<d;D++){this.m_stack[D]=this.getIdentity()}if(C!==m){this.m_stack[0]=C}else{this.setIdentity()}};v.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity();if(this.valid===this.c_stack&&this.c_stack){this.valid--}};v.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]};v.prototype.getResult=function(){if(!this.c_stack){return this.m_stack[0]}var C=o.identity;if(this.valid>this.c_stack-1){this.valid=this.c_stack-1}for(var D=this.valid;D<this.c_stack+1;D++){C=o.multiply(this.m_stack[D],C);this.m_cache[D]=C}this.valid=this.c_stack-1;this.result=this.m_cache[this.c_stack];return this.result};v.prototype.pushMatrix=function(){this.c_stack++;this.m_stack[this.c_stack]=this.getIdentity()};v.prototype.popMatrix=function(){if(this.c_stack===0){return}this.c_stack--};var u=v.prototype.getIdentity();v.prototype.translate=function(C,D){u[6]=C;u[7]=D;o.multiply(u,this.m_stack[this.c_stack])};var k=v.prototype.getIdentity();v.prototype.scale=function(C,D){k[0]=C;k[4]=D;o.multiply(k,this.m_stack[this.c_stack])};var a=v.prototype.getIdentity();v.prototype.rotate=function(C){var D,E;D=t.sin(-C);E=t.cos(-C);a[0]=E;a[3]=D;a[1]=-D;a[4]=E;o.multiply(a,this.m_stack[this.c_stack])};var r=this.WebGL2D=function r(D,C){this.canvas=D;this.options=C||{};this.gl=m;this.fs=m;this.vs=m;this.shaderProgram=m;this.transform=new v();this.shaderPool=[];this.maxTextureSize=m;D.gl2d=this;D.$getContext=D.getContext;D.getContext=(function(E){return function(F){if((E.options.force||F==="webgl-2d")&&!(D.width===0||D.height===0)){if(E.gl){return E.gl}var G=E.gl=E.canvas.$getContext("experimental-webgl");E.initShaders();E.initBuffers();E.initCanvas2DAPI();G.viewport(0,0,E.canvas.width,E.canvas.height);G.clearColor(1,1,1,1);G.clear(G.COLOR_BUFFER_BIT);G.colorMask(1,1,1,0);G.enable(G.BLEND);G.blendFunc(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA);E.maxTextureSize=G.getParameter(G.MAX_TEXTURE_SIZE);return G}else{return E.canvas.$getContext(F)}}}(this));this.postInit()};r.enable=function(D,C){return D.gl2d||new r(D,C)};var j={texture:1,crop:2,path:4};r.prototype.getFragmentShaderSource=function e(D){var C=["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+((D&j.texture)?"1":"0"),"#define hasCrop "+((D&j.crop)?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);","#else","gl_FragColor = texture2D(uSampler, vTextureCoord);","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n");return C};r.prototype.getVertexShaderSource=function g(E,G){var D=2/this.canvas.width,F=-2/this.canvas.height;E=E||1;var C=["#define hasTexture "+((G&j.texture)?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+E+"];","varying vec4 vColor;","const mat4 pMatrix = mat4("+D+",0,0,0, 0,"+F+",0,0, 0,0,1.0,1.0, -1.0,1.0,0,0);","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+E+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n");return C};r.prototype.initShaders=function B(G,F){var H=this.gl;G=G||1;F=F||0;var D=this.shaderPool[G];if(!D){D=this.shaderPool[G]=[]}D=D[F];if(D){H.useProgram(D);this.shaderProgram=D;return D}else{var C=this.fs=H.createShader(H.FRAGMENT_SHADER);H.shaderSource(this.fs,this.getFragmentShaderSource(F));H.compileShader(this.fs);if(!H.getShaderParameter(this.fs,H.COMPILE_STATUS)){throw"fragment shader error: "+H.getShaderInfoLog(this.fs)}var J=this.vs=H.createShader(H.VERTEX_SHADER);H.shaderSource(this.vs,this.getVertexShaderSource(G,F));H.compileShader(this.vs);if(!H.getShaderParameter(this.vs,H.COMPILE_STATUS)){throw"vertex shader error: "+H.getShaderInfoLog(this.vs)}var I=this.shaderProgram=H.createProgram();I.stackDepth=G;H.attachShader(I,C);H.attachShader(I,J);H.linkProgram(I);if(!H.getProgramParameter(I,H.LINK_STATUS)){throw"Could not initialise shaders."}H.useProgram(I);I.vertexPositionAttribute=H.getAttribLocation(I,"aVertexPosition");H.enableVertexAttribArray(I.vertexPositionAttribute);I.uColor=H.getUniformLocation(I,"uColor");I.uSampler=H.getUniformLocation(I,"uSampler");I.uCropSource=H.getUniformLocation(I,"uCropSource");I.uTransforms=[];for(var E=0;E<G;++E){I.uTransforms[E]=H.getUniformLocation(I,"uTransforms["+E+"]")}this.shaderPool[G][F]=I;return I}};var q;var s;var f;var y;var p=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]);r.prototype.initBuffers=function w(){var C=this.gl;q=C.createBuffer();s=C.createBuffer();f=C.createBuffer();y=C.createBuffer();C.bindBuffer(C.ARRAY_BUFFER,q);C.bufferData(C.ARRAY_BUFFER,p,C.STATIC_DRAW)};r.instances=[];r.prototype.postInit=function(){r.instances.push(this)};r.prototype.initCanvas2DAPI=function c(){var Y=this,O=this.gl;var ac=document.createElement("canvas");ac.width=Y.canvas.width;ac.height=Y.canvas.height;var T=ac.getContext("2d");var R=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/;var aH=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/;var ay=/^#([0-9A-Fa-f]{6})$/;var Q=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/;function an(aM,aS,aL,aP){var aJ,aN,aO,aR,aQ;aM=(((aM%360)+360)%360)/360;aS=aS>100?1:aS/100;aS=aS<0?0:aS;aL=aL>100?1:aL/100;aL=aL<0?0:aL;aQ=aL<=0.5?aL*(aS+1):aL+aS-aL*aS;aR=aL*2-aQ;function aK(aU){var aT;if(aU*6<1){aT=aR+(aQ-aR)*aU*6}else{if(aU*2<1){aT=aQ}else{if(aU*3<2){aT=aR+(aQ-aR)*(2/3-aU)*6}else{aT=aR}}}return aT}aJ=aK(aM+1/3);aN=aK(aM);aO=aK(aM-1/3);return[aJ,aN,aO,aP]}function C(aS){var aT=[],aN,aP,aJ,aM,aK,aO;if((aN=R.exec(aS))){aM=aN[1],aK=parseFloat(aN[8]);if((aM&&isNaN(aK))||(!aM&&!isNaN(aK))){return false}aO=aN[3];for(var aL=2;aL<8;aL+=2){aP=aN[aL],aJ=aN[aL+1];if(aJ!==aO){return false}if(aJ){aP=aP>100?1:aP/100;aP=aP<0?0:aP}else{aP=aP>255?1:aP/255;aP=aP<0?0:aP}aT.push(aP)}aT.push(aM?aK:1)}else{if((aN=aH.exec(aS))){aM=aN[1],aK=parseFloat(aN[5]);aT=an(aN[2],aN[3],aN[4],parseFloat(aM&&aK?aK:1))}else{if((aN=ay.exec(aS))){var aQ=parseInt(aN[1],16);aT=[((aQ&16711680)>>16)/255,((aQ&65280)>>8)/255,(aQ&255)/255,1]}else{if((aN=Q.exec(aS))){var aR="#"+[aN[1],aN[1],aN[2],aN[2],aN[3],aN[3]].join("");aT=C(aR)}else{if(aS.toLowerCase() in ae){aT=C(ae[aS.toLowerCase()])}else{if(aS.toLowerCase()==="transparent"){aT=[0,0,0,0]}else{return false}}}}}}return aT}function V(aJ){return"rgba("+(aJ[0]*255)+", "+(aJ[1]*255)+", "+(aJ[2]*255)+", "+parseFloat(aJ[3])+")"}var ae={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var aG={},aI=[];function E(aL){var aK={};for(var aJ in aL){if(aL.hasOwnProperty(aJ)){aK[aJ]=aL[aJ]}}return aK}function at(){var aJ={fillStyle:[aG.fillStyle[0],aG.fillStyle[1],aG.fillStyle[2],aG.fillStyle[3]],strokeStyle:[aG.strokeStyle[0],aG.strokeStyle[1],aG.strokeStyle[2],aG.strokeStyle[3]],globalAlpha:aG.globalAlpha,globalCompositeOperation:aG.globalCompositeOperation,lineCap:aG.lineCap,lineJoin:aG.lineJoin,lineWidth:aG.lineWidth,miterLimit:aG.miterLimit,shadowColor:aG.shadowColor,shadowBlur:aG.shadowBlur,shadowOffsetX:aG.shadowOffsetX,shadowOffsetY:aG.shadowOffsetY,textAlign:aG.textAlign,font:aG.font,textBaseline:aG.textBaseline};aI.push(aJ)}function W(){if(aI.length){aG=aI.pop()}}aG.fillStyle=[0,0,0,1];Object.defineProperty(O,"fillStyle",{get:function(){return V(aG.fillStyle)},set:function(aJ){aG.fillStyle=C(aJ)||aG.fillStyle}});aG.strokeStyle=[0,0,0,1];Object.defineProperty(O,"strokeStyle",{get:function(){return V(aG.strokeStyle)},set:function(aJ){aG.strokeStyle=C(aJ)||drawStyle.strokeStyle}});O.$lineWidth=O.lineWidth;aG.lineWidth=1;Object.defineProperty(O,"lineWidth",{get:function(){return aG.lineWidth},set:function(aJ){O.$lineWidth(aJ);aG.lineWidth=aJ}});aG.lineCap="butt";Object.defineProperty(O,"lineCap",{get:function(){return aG.lineCap},set:function(aJ){aG.lineCap=aJ}});aG.lineJoin="miter";Object.defineProperty(O,"lineJoin",{get:function(){return aG.lineJoin},set:function(aJ){aG.lineJoin=aJ}});aG.miterLimit=10;Object.defineProperty(O,"miterLimit",{get:function(){return aG.miterLimit},set:function(aJ){aG.miterLimit=aJ}});aG.shadowOffsetX=0;Object.defineProperty(O,"shadowOffsetX",{get:function(){return aG.shadowOffsetX},set:function(aJ){aG.shadowOffsetX=aJ}});aG.shadowOffsetY=0;Object.defineProperty(O,"shadowOffsetY",{get:function(){return aG.shadowOffsetY},set:function(aJ){aG.shadowOffsetY=aJ}});aG.shadowBlur=0;Object.defineProperty(O,"shadowBlur",{get:function(){return aG.shadowBlur},set:function(aJ){aG.shadowBlur=aJ}});aG.shadowColor="rgba(0, 0, 0, 0.0)";Object.defineProperty(O,"shadowColor",{get:function(){return aG.shadowColor},set:function(aJ){aG.shadowColor=aJ}});aG.font="10px sans-serif";Object.defineProperty(O,"font",{get:function(){return aG.font},set:function(aJ){T.font=aJ;aG.font=aJ}});aG.textAlign="start";Object.defineProperty(O,"textAlign",{get:function(){return aG.textAlign},set:function(aJ){aG.textAlign=aJ}});aG.textBaseline="alphabetic";Object.defineProperty(O,"textBaseline",{get:function(){return aG.textBaseline},set:function(aJ){aG.textBaseline=aJ}});aG.globalAlpha=1;Object.defineProperty(O,"globalAlpha",{get:function(){return aG.globalAlpha},set:function(aJ){aG.globalAlpha=aJ}});aG.globalCompositeOperation="source-over";Object.defineProperty(O,"globalCompositeOperation",{get:function(){return aG.globalCompositeOperation},set:function(aJ){aG.globalCompositeOperation=aJ}});O.fillText=function az(aK,aJ,aL){};O.strokeText=function ad(){};O.measureText=function ax(){return 1};var am=document.createElement("canvas");var au=am.getContext("2d");O.save=function Z(){Y.transform.pushMatrix();at()};O.restore=function ab(){Y.transform.popMatrix();W()};O.translate=function G(aJ,aK){Y.transform.translate(aJ,aK)};O.rotate=function aF(aJ){Y.transform.rotate(aJ)};O.scale=function ao(aJ,aK){Y.transform.scale(aJ,aK)};O.createImageData=function al(aK,aJ){return au.createImageData(aK,aJ)};O.getImageData=function aE(aU,aT,aJ,aW){var aN=au.createImageData(aJ,aW);var aL=new Uint8Array(aJ*aW*4);O.readPixels(aU,aT,aJ,aW,O.RGBA,O.UNSIGNED_BYTE,aL);var aV=aJ*4,aO=aW;for(var aM=0,aS=aO/2;aM<aS;++aM){for(var aK=0,aR=aV;aK<aR;++aK){var aQ=aM*aV+aK;var aP=(aO-aM-1)*aV+aK;aN.data[aQ]=aL[aP];aN.data[aP]=aL[aQ]}}return aN};O.putImageData=function av(aL,aJ,aK){O.drawImage(aL,aJ,aK)};O.transform=function ai(aN,aM,aP,aO,aL,aK){var aJ=Y.transform.m_stack[Y.transform.c_stack];aJ[0]*=aN;aJ[1]*=aP;aJ[2]*=aL;aJ[3]*=aM;aJ[4]*=aO;aJ[5]*=aK;aJ[6]=0;aJ[7]=0};function I(aM){var aJ=Y.transform.m_stack;for(var aL=0,aK=Y.transform.c_stack+1;aL<aK;++aL){O.uniformMatrix3fv(aM.uTransforms[aL],false,aJ[aK-1-aL])}}O.setTransform=function H(aM,aL,aO,aN,aK,aJ){Y.transform.setIdentity();O.transform.apply(this,arguments)};O.fillRect=function aB(aK,aO,aM,aJ){var aL=Y.transform;var aN=Y.initShaders(aL.c_stack+2,0);O.bindBuffer(O.ARRAY_BUFFER,q);O.vertexAttribPointer(aN.vertexPositionAttribute,4,O.FLOAT,false,0,0);aL.pushMatrix();aL.translate(aK,aO);aL.scale(aM,aJ);I(aN);O.uniform4f(aN.uColor,aG.fillStyle[0],aG.fillStyle[1],aG.fillStyle[2],aG.fillStyle[3]);O.drawArrays(O.TRIANGLE_FAN,0,4);aL.popMatrix()};O.strokeRect=function af(aK,aO,aM,aJ){var aL=Y.transform;var aN=Y.initShaders(aL.c_stack+2,0);O.bindBuffer(O.ARRAY_BUFFER,q);O.vertexAttribPointer(aN.vertexPositionAttribute,4,O.FLOAT,false,0,0);aL.pushMatrix();aL.translate(aK,aO);aL.scale(aM,aJ);I(aN);O.uniform4f(aN.uColor,aG.strokeStyle[0],aG.strokeStyle[1],aG.strokeStyle[2],aG.strokeStyle[3]);O.drawArrays(O.LINE_LOOP,0,4);aL.popMatrix()};O.clearRect=function J(aK,aM,aL,aJ){};var L=[];function aa(aJ,aK){this.closed=false;this.verts=[aJ,aK,0,0]}O.beginPath=function aq(){L.length=0};O.closePath=function P(){if(L.length){var aL=L[L.length-1],aK=aL.verts[0],aJ=aL.verts[1];aL.closed=true;var aM=new aa(aK,aJ);L.push(aM)}};O.moveTo=function D(aJ,aK){L.push(new aa(aJ,aK))};O.lineTo=function aD(aJ,aK){if(L.length){L[L.length-1].verts.push(aJ,aK,0,0)}else{O.moveTo(aJ,aK)}};O.quadraticCurveTo=function aC(aL,aK,aJ,aM){};O.bezierCurveTo=function ap(aL,aK,aN,aM,aJ,aO){};O.arcTo=function K(){};O.rect=function ak(aJ,aM,aK,aL){O.moveTo(aJ,aM);O.lineTo(aJ+aK,aM);O.lineTo(aJ+aK,aM+aL);O.lineTo(aJ,aM+aL);O.closePath()};O.arc=function ag(aK,aO,aJ,aM,aL,aN){};function N(aL){var aK=Y.transform;var aN=Y.initShaders(aK.c_stack+2,0);var aJ=L[aL];var aM=aJ.verts;O.bindBuffer(O.ARRAY_BUFFER,f);O.bufferData(O.ARRAY_BUFFER,new Float32Array(aM),O.STATIC_DRAW);O.vertexAttribPointer(aN.vertexPositionAttribute,4,O.FLOAT,false,0,0);aK.pushMatrix();I(aN);O.uniform4f(aN.uColor,aG.fillStyle[0],aG.fillStyle[1],aG.fillStyle[2],aG.fillStyle[3]);O.drawArrays(O.TRIANGLE_FAN,0,aM.length/4);aK.popMatrix()}O.fill=function U(){for(var aJ=0;aJ<L.length;aJ++){N(aJ)}};function aA(aL){var aK=Y.transform;var aN=Y.initShaders(aK.c_stack+2,0);var aJ=L[aL];var aM=aJ.verts;O.bindBuffer(O.ARRAY_BUFFER,f);O.bufferData(O.ARRAY_BUFFER,new Float32Array(aM),O.STATIC_DRAW);O.vertexAttribPointer(aN.vertexPositionAttribute,4,O.FLOAT,false,0,0);aK.pushMatrix();I(aN);O.uniform4f(aN.uColor,aG.strokeStyle[0],aG.strokeStyle[1],aG.strokeStyle[2],aG.strokeStyle[3]);if(aJ.closed){O.drawArrays(O.LINE_LOOP,0,aM.length/4)}else{O.drawArrays(O.LINE_STRIP,0,aM.length/4)}aK.popMatrix()}O.stroke=function aj(){for(var aJ=0;aJ<L.length;aJ++){aA(aJ)}};O.clip=function ar(){};O.isPointInPath=function X(){};O.drawFocusRing=function aw(){};var M=[],ah=[];function S(aL){this.obj=O.createTexture();this.index=ah.push(this);M.push(aL);if(aL.width>Y.maxTextureSize||aL.height>Y.maxTextureSize){var aK=document.createElement("canvas");aK.width=(aL.width>Y.maxTextureSize)?Y.maxTextureSize:aL.width;aK.height=(aL.height>Y.maxTextureSize)?Y.maxTextureSize:aL.height;var aJ=aK.getContext("2d");aJ.drawImage(aL,0,0,aL.width,aL.height,0,0,aK.width,aK.height);aL=aK}O.bindTexture(O.TEXTURE_2D,this.obj);O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,aL);O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE);O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE);O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR);if(n(aL.width)&&n(aL.height)){O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR_MIPMAP_LINEAR);O.generateMipmap(O.TEXTURE_2D)}else{O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR)}O.bindTexture(O.TEXTURE_2D,null)}O.drawImage=function F(aL,aW,aV,aT,aS,aQ,aP,aO,aN){var aK=Y.transform;aK.pushMatrix();var aM=j.texture;var aX=false;if(arguments.length===3){aK.translate(aW,aV);aK.scale(aL.width,aL.height)}else{if(arguments.length===5){aK.translate(aW,aV);aK.scale(aT,aS)}else{if(arguments.length===9){aK.translate(aQ,aP);aK.scale(aO,aN);aM=aM|j.crop;aX=true}}}var aJ=Y.initShaders(aK.c_stack,aM);var aR,aU=M.indexOf(aL);if(aU!==-1){aR=ah[aU]}else{aR=new S(aL)}if(aX){O.uniform4f(aJ.uCropSource,aW/aL.width,aV/aL.height,aT/aL.width,aS/aL.height)}O.bindBuffer(O.ARRAY_BUFFER,q);O.vertexAttribPointer(aJ.vertexPositionAttribute,4,O.FLOAT,false,0,0);O.bindTexture(O.TEXTURE_2D,aR.obj);O.activeTexture(O.TEXTURE0);O.uniform1i(aJ.uSampler,0);I(aJ);O.drawArrays(O.TRIANGLE_FAN,0,4);aK.popMatrix()}}}(Math));FF.Util=function(){};FF.Util.createRender=function(a){var b=(window.WebGLRenderingContext)?new FF.CanvasRender():new FF.CanvasRender();b.createRender(a);return b};FF.Util.h2r=function(c){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;c=c.replace(b,function(e,h,f,d){return h+h+f+f+d+d});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};FF.Util.r2h=function(d,c,a){return"#"+((1<<24)+(d<<16)+(c<<8)+a).toString(16).slice(1)};FF.Util.screenSize=function(){var a={width:0,height:0};if(!window.innerWidth){if(!(document.documentElement.clientWidth==0)){a.width=document.documentElement.clientWidth;a.height=document.documentElement.clientHeight}else{a.width=document.body.clientWidth;a.height=document.body.clientHeight}}else{a.width=window.innerWidth;a.height=window.innerHeight}return a};FF.Util.screenWidth=function(){return FF.Util.screenSize().width};FF.Util.screenHeight=function(){return FF.Util.screenSize().height};FF.Util.getCenterFromItem=function(b,a){return(!a)?FF.Render.getWidth()/2-b.rect().width/2:FF.Render.getHeight()/2-b.rect().height/2};FF.Util.getBrowserInfos=function(){return{name:navigator.appName,version:navigator.appVersion}};FF.Util.getXMLHttpRequest=function(){return(window.XMLHttpRequest)?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP")};FF.Util.ajax=function(c){var e=c.type||"POST";var d=c.async||true;var b=c.url||"";var a=c.complete||function(g){};var f=FF.Util.getXMLHttpRequest();f.onreadystatechange=function(){if(f.readyState==4){a(f.responseText)}};f.open(e,b,d);f.send()};FF.Util.collideRects=function(b,a){b.right=b.x+b.width;b.bottom=b.y+b.height;a.right=a.x+a.width;a.bottom=a.y+a.height;return((b.x>=a.x&&b.x<=a.right)||(a.x>=b.x&&a.x<=b.right))&&((b.y>=a.y&&b.y<=a.bottom)||(a.y>=b.y&&a.y<=b.bottom))};FF.Util.collideOneWithOne=function(b,a){if(b.rect&&a.rect&&b!==a&&FF.Util.collideRects(b.rect(),a.rect())){return true}else{return false}};FF.Util.collideOneWithMany=function(c,d){var b=[];if(d!==undefined){if(d.foreach){d.foreach(function(e){if(FF.Util.collideOneWithOne(c,e)){b.push(e)}})}else{if(d instanceof Array||d.length){for(var a=0;a<d.length;a++){if(FF.Util.collideOneWithOne(c,d[a])){b.push(d[a])}}}else{for(var a in d){if(FF.Util.collideOneWithOne(c,d[a])){b.push(d[a])}}}}}return b};FF.Util.isArray=function(a){return(a instanceof Array)?true:false};FF.Util.isString=function(a){return(typeof a=="string")?true:false};FF.Util.getDOMDocument=function(a){var b=null;if(window.DOMParser){parser=new DOMParser();b=parser.parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM");b.async=false;b.loadXML(a)}return b};FF.Util.random=function(b,a){return Math.floor(Math.random()*(a-b+1)+b)};FF.Util.array_first=function(a){for(var b in a){return a[b]}};FF.Util.array_first_key=function(){for(var a in arr){return a}};FF.Animation=function(c,d,a){FF.EventManager.call(this);var b=this;this.node=c;this.timer=new FF.Timer({timeout:d,interval:a.step||10,autostart:a.autostart||false});this.timer.addEventListener("start",function(f){b.resetValues();b.dispatchEvent({type:"start"})});this.timer.addEventListener("tick",function(f){b.animate(f);b.dispatchEvent({type:"step"})});this.timer.addEventListener("timeout",function(){b.dispatchEvent({type:"end"})});this.options=a};FF.Animation.prototype.update=function(){this.timer.update()};FF.Animation.prototype.animate=function(a){var b=parseFloat(a.completion);if(this.options.left){this.node.x=this.originalX-(this.options.left*b)}if(this.options.right){this.node.x=this.originalX+(this.options.right*b)}if(this.options.top){this.node.y=this.originalY-(this.options.top*b)}if(this.options.bottom){this.node.y=this.originalY+(this.options.bottom*b)}if(this.options.width||this.options.width==0){this.node.width=this.originalWidth+((this.options.width-this.originalWidth)*b)}if(this.options.height||this.options.height==0){this.node.height=this.originalHeight+((this.options.height-this.originalHeight)*b)}if(this.options.scale||this.options.scale==0){this.node.scale=this.originalScale+((this.options.scale-this.originalScale)*b)}if(this.options.opacity||this.options.opacity==0){this.node.alpha=this.originalAlpha+((this.options.opacity-this.originalAlpha)*b)}};FF.Animation.prototype.start=function(){this.timer.restart()};FF.Animation.prototype.resetValues=function(){this.originalX=this.node.rect().x;this.originalY=this.node.rect().y;this.originalWidth=this.node.rect().width;this.originalHeight=this.node.rect().height;this.originalScale=this.node.scale;this.originalAlpha=this.node.alpha};FF.EventManager=function(){var a=[];this.addEventListener=function(b,c){if(a[b]===undefined){a[b]=[]}if(a[b].indexOf(c)===-1){a[b].push(c)}};this.dispatchEvent=function(b){for(var c in a[b.type]){a[b.type][c](b)}};this.removeEventListener=function(c,d){var b=a[c].indexOf(d);if(b!==-1){a[c].splice(b,1)}}};FF.Game=function(d,b){var c=this;this.previousGameState=null;this.currentGameState=d;this.backgroundColor=b.backgroundColor||"#FFF";this.lastCalledTime=null;this.fps=0;this.launch=function(){if(this.currentGameState.isStarted==true){throw new Error("[FF.Game.Start] Your GameState is already started")}if(this.currentGameState.setup===undefined){throw new Error("[FF.Game.Start] Your GameState have to contain a setup() function")}if(FF.Render.canvas===undefined){FF.Render=FF.Util.createRender(b.view)}if(FF.InputManager.isSetup==false){FF.InputManager.setup()}this.currentGameState.setup();if(this.currentGameState.isStarted===undefined||this.currentGameState.isStarted==false){this.currentGameState.isStarted=true}a()};function a(){if(c.currentGameState.update===undefined){throw new Error("[FF.Game.requestAnimationFrame] Your GameState have to contain an update() function (even if you let it empty)")}if(c.currentGameState.draw===undefined){throw new Error("[FF.Game.requestAnimationFrame] Your GameState have to contain an draw() function (even if you let it empty)")}FF.InputManager.getGamepads();if(c.currentGameState.isStarted){c.currentGameState.update();FF.Render.clearRect(0,0,FF.Render.getWidth(),FF.Render.getHeight());FF.Render.setBackgroundColor(c.backgroundColor);c.currentGameState.draw()}if(c.lastCalledTime==null){c.lastCalledTime=new Date().getTime();c.fps=0;requestAnimationFrame(a);return}var e=(new Date().getTime()-c.lastCalledTime)/1000;c.lastCalledTime=new Date().getTime();c.fps=(1/e).toFixed(1);requestAnimationFrame(a)}};FF.Game.prototype.switchGameState=function(b,a){if(b===undefined){throw new Error("[FF.Game.switchGameState] Your gamestate is undefined (not instanciated, like gs = new Blablabla();)")}this.previousGameState=this.currentGameState;this.currentGameState=(a)?new b.constructor:b;if(this.currentGameState.setup===undefined){throw new Error("[FF.Game.switchGameState] Your GameState have to contain a setup() function")}if(this.currentGameState.isStarted==false){FF.InputManager.resetPressedKeys();this.currentGameState.setup();this.currentGameState.isStarted=true}};FF.GameState=function(a){this.children=[];this.isStarted=false;this.setup=function(){for(var b in this.children){this.children[b].setup()}if(a.setup){a.setup()}};this.update=function(){for(var b in this.children){this.children[b].update()}if(a.update){a.update()}};this.draw=function(){for(var b in this.children){this.children[b].draw()}if(a.draw){a.draw()}};this.add=function(b){if(!b.setup||!b.update||!b.draw){throw new Error("[FF.GameState.add] Your item have to contain .setup(), .update() & .draw() functions")}this.children.push(b)}};FF.InputManager={};FF.InputManager.isSetup=false;FF.InputManager.mouse_x=0;FF.InputManager.mouse_y=0;FF.InputManager.pressed_keys=[];FF.InputManager.previously_pressed_keys=[];FF.InputManager.keycode_to_string=[];FF.InputManager.on_keydown_callbacks=[];FF.InputManager.on_keyup_callbacks=[];FF.InputManager.mousebuttoncode_to_string=[];FF.InputManager.ie_mousebuttoncode_to_string=[];FF.InputManager.prevent_default_keys=[];FF.InputManager.gamepads={};FF.InputManager.gamepad_to_string=[];FF.InputManager.gamepad_axis_values={left:{x:0,y:0},right:{x:0,y:0},triggers:{left:0,right:0}};FF.InputManager.gamepad_deadzones={left_axis:8689/32767,right_axis:7849/32767,top_triggers:0.5,bottom_triggers:30/255};FF.InputManager.setup=function(){var e=[];e[8]="backspace";e[9]="tab";e[13]="enter";e[16]="shift";e[17]="ctrl";e[18]="alt";e[19]="pause";e[20]="capslock";e[27]="esc";e[32]="space";e[33]="pageup";e[34]="pagedown";e[35]="end";e[36]="home";e[37]="left";e[38]="up";e[39]="right";e[40]="down";e[45]="insert";e[46]="delete";e[91]="left_window_key leftwindowkey";e[92]="right_window_key rightwindowkey";e[93]="select_key selectkey";e[106]="multiply *";e[107]="add plus +";e[109]="subtract minus -";e[110]="decimalpoint";e[111]="divide /";e[144]="numlock";e[145]="scrollock";e[186]="semicolon ;";e[187]="equalsign =";e[188]="comma ,";e[189]="dash -";e[190]="period .";e[191]="forwardslash /";e[192]="graveaccent `";e[219]="openbracket [";e[220]="backslash \\";e[221]="closebracket ]";e[222]="singlequote '";var b=[];b[0]="left_mouse_button";b[1]="center_mouse_button";b[2]="right_mouse_button";var h=[];h[1]="left_mouse_button";h[2]="right_mouse_button";h[4]="center_mouse_button";FF.InputManager.mousebuttoncode_to_string=b;FF.InputManager.ie_mousebuttoncode_to_string=h;var n=["numpad0","numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"];var a=["f1","f2","f3","f4","f5","f6","f7","f8","f9"];var j=["0","1","2","3","4","5","6","7","8","9"];var g=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];for(var f=0;j[f];f++){e[48+f]=j[f]}for(var f=0;g[f];f++){e[65+f]=g[f]}for(var f=0;n[f];f++){e[96+f]=n[f]}for(var f=0;a[f];f++){e[112+f]=a[f]}FF.InputManager.keycode_to_string=e;var c=[];c[0]="gamepad_face_button_1";c[1]="gamepad_face_button_2";c[2]="gamepad_face_button_3";c[3]="gamepad_face_button_4";c[4]="gamepad_top_left_shoulder";c[5]="gamepad_top_right_shoulder";c[6]="gamepad_bottom_left_shoulder";c[7]="gamepad_bottom_right_shoulder";c[8]="gamepad_select";c[9]="gamepad_start";c[10]="gamepad_left_analogue_click";c[11]="gamepad_right_analogue_click";c[12]="gamepad_top";c[13]="gamepad_bottom";c[14]="gamepad_left";c[15]="gamepad_right";var d=[];d[0]="gamepad_left_x";d[1]="gamepad_left_y";d[2]="gamepad_right_x";d[3]="gamepad_right_y";FF.InputManager.gamepad_to_string={buttons:c,axis:d};window.addEventListener("keydown",FF.InputManager.handleKeyDown);window.addEventListener("keyup",FF.InputManager.handleKeyUp);window.addEventListener("mousedown",FF.InputManager.handleMouseDown,false);window.addEventListener("mouseup",FF.InputManager.handleMouseUp,false);window.addEventListener("mousemove",FF.InputManager.handleMouseMove,false);window.addEventListener("touchstart",FF.InputManager.handleTouchStart,false);window.addEventListener("touchend",FF.InputManager.handleTouchEnd,false);window.addEventListener("blur",FF.InputManager.resetPressedKeys,false);document.oncontextmenu=function(){return false};FF.InputManager.isSetup=true};FF.InputManager.resetPressedKeys=function(a){FF.InputManager.pressed_keys={}};FF.InputManager.handleKeyUp=function(c){c=c||window.event;var b=FF.InputManager.keycode_to_string[c.keyCode].split(" ");for(i in b){var a=b[i];FF.InputManager.pressed_keys[a]=false;if(FF.InputManager.on_keyup_callbacks[a]){FF.InputManager.on_keyup_callbacks[a](a);c.preventDefault()}if(FF.InputManager.prevent_default_keys[a]){c.preventDefault()}}};FF.InputManager.handleKeyDown=function(c){c=c||window.event;var b=FF.InputManager.keycode_to_string[c.keyCode].split(" ");for(i in b){var a=b[i];FF.InputManager.pressed_keys[a]=true;if(FF.InputManager.on_keydown_callbacks[a]){FF.InputManager.on_keydown_callbacks[a](a);c.preventDefault()}if(FF.InputManager.prevent_default_keys[a]){c.preventDefault()}}};FF.InputManager.handleMouseDown=function(b){b=b||window.event;var a=FF.InputManager.mousebuttoncode_to_string[b.button];if(navigator.appName=="Microsoft Internet Explorer"){a=FF.InputManager.ie_mousebuttoncode_to_string[b.button]}FF.InputManager.pressed_keys[a]=true;if(FF.InputManager.on_keydown_callbacks[a]){FF.InputManager.on_keydown_callbacks[a](a);b.preventDefault()}};FF.InputManager.handleMouseUp=function(b){b=b||window.event;var a=FF.InputManager.mousebuttoncode_to_string[b.button];if(navigator.appName=="Microsoft Internet Explorer"){a=FF.InputManager.ie_mousebuttoncode_to_string[b.button]}FF.InputManager.pressed_keys[a]=false;if(FF.InputManager.on_keyup_callbacks[a]){FF.InputManager.on_keyup_callbacks[a](a);b.preventDefault()}};FF.InputManager.handleMouseMove=function(a){a=a||window.event;if(a.pageX||a.pageY){FF.InputManager.mouse_x=a.pageX;FF.InputManager.mouse_y=a.pageY}else{FF.InputManager.mouse_x=a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;FF.InputManager.mouse_y=a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}};FF.InputManager.handleTouchStart=function(a){a=a||window.event;FF.InputManager.pressed_keys.left_mouse_button=true;FF.InputManager.mouse_x=a.touches[0].pageX-FF.Render.View.offsetLeft;FF.InputManager.mouse_y=a.touches[0].pageY-FF.Render.View.offsetTop};FF.InputManager.handleTouchEnd=function(a){a=a||window.event;FF.InputManager.pressed_keys.left_mouse_button=false;FF.InputManager.mouse_x=undefined;FF.InputManager.mouse_y=undefined};FF.InputManager.preventDefaultKeys=function(b){if(!FF.Util.isString(b)){b=b.split(" ")}for(var a in b){FF.InputManager.prevent_default_keys[b[a]]=true}};FF.InputManager.pressed=function(b,a){if(FF.Util.isString(b)){b=b.split(" ")}if(a){return b.every(function(c){return FF.InputManager.pressed_keys[c]})}else{return b.some(function(c){return FF.InputManager.pressed_keys[c]})}};FF.InputManager.pressedWithoutRepeat=function(b,a){if(FF.InputManager.pressed(b,a)){if(!FF.InputManager.previously_pressed_keys[b]){FF.InputManager.previously_pressed_keys[b]=true;return true}}else{FF.InputManager.previously_pressed_keys[b]=false;return false}};FF.InputManager.on_keydown=function(b,c){if(FF.Util.isArray(b)){for(var a=0;b[a];a++){FF.InputManager.on_keydown_callbacks[b[a]]=c}}else{FF.InputManager.on_keydown_callbacks[b]=c}};FF.InputManager.on_keyup=function(b,c){if(FF.Util.isArray(b)){for(var a=0;b[a];a++){FF.InputManager.on_keyup_callbacks[b[a]]=c}}else{FF.InputManager.on_keyup_callbacks[b]=c}};FF.InputManager.clearKeyCallbacks=function(){FF.InputManager.on_keyup_callbacks=[];FF.InputManager.on_keydown_callbacks=[]};FF.InputManager.getGamepads=function(){if(navigator.getGamepads){FF.InputManager.gamepads=navigator.getGamepads();FF.InputManager.checkGamepadButtons()}};FF.InputManager.checkGamepadButtons=function(){var b=FF.InputManager.getCurrentConnectedGamepad();for(var a in b.buttons){FF.InputManager.pressed_keys[FF.InputManager.gamepad_to_string.buttons[a]]=b.buttons[a].pressed||b.buttons[a].value>((a===6||a===7)?FF.InputManager.gamepad_deadzones.bottom_triggers:0.5)}for(var a in b.axes){FF.InputManager.pressed_keys[FF.InputManager.gamepad_to_string.axis[a]]=b.axes[a]>((a===0||a===1)?FF.InputManager.gamepad_deadzones.left_axis:FF.InputManager.gamepad_deadzones.right_axis)}FF.InputManager.gamepad_axis_values.left.x=b.axes[0];FF.InputManager.gamepad_axis_values.left.y=b.axes[1];FF.InputManager.gamepad_axis_values.right.x=b.axes[2];FF.InputManager.gamepad_axis_values.right.y=b.axes[3];FF.InputManager.gamepad_axis_values.triggers.left=b.buttons[6].value;FF.InputManager.gamepad_axis_values.triggers.right=b.buttons[7].value};FF.InputManager.getCurrentConnectedGamepad=function(){for(var a in FF.InputManager.gamepads){if(FF.InputManager.gamepads[a].connected){return FF.InputManager.gamepads[a]}}};FF.Shooter=function(){};FF.Shooter.affine=function(a,b){return{A:(b.y-a.y)/(b.x-a.x),B:(b.x*a.y-a.x*b.y)/(b.x-a.x),origin:a,dest:b}};FF.Shooter.shootAt=function(d,e){var b=e.x-d.x;var a=e.y-d.y;var c={x:b*3,y:a*3};if(FF.Shooter.distanceBetween(d,e)<10){c.x*=30;c.y*=30}return{speed:c,origin:d,dest:e}};FF.Shooter.realMoveSpeed=function(a){return(GAME.fps=="Infinity"||a*(60/GAME.fps)/1.2=="Infinity")?a:a*(60/GAME.fps)/1.2};FF.Shooter.mouseInViewport=function(a){return{x:FF.InputManager.mouse_x+a.rect().x,y:FF.InputManager.mouse_y+a.rect().y}};FF.Shooter.turnAroundMouse=function(a,b){return FF.Shooter.toDegrees(Math.atan2(b.x-a.x,a.y-b.y))};FF.Shooter.toDegrees=function(a){return(a>0?a:(2*Math.PI+a))*360/(2*Math.PI)};FF.Shooter.distanceBetween=function(b,a){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};FF.Timer=function(a){FF.EventManager.call(this);var b=this;this.time=0;this.timeout=a.timeout||10000;this.interval=a.interval||1000;this.lastTick=new Date();this.autostart=a.autostart||false;this.active=a.autostart||false;if(this.autostart){this.dispatchEvent({type:"start",timeout:b.timeout})}};FF.Timer.prototype.update=function(){if(!this.active){return}var a=this;if(this.time>=this.timeout){this.dispatchEvent({type:"timeout"});this.reset()}if(new Date()-this.lastTick>=this.interval){this.time+=this.interval;this.dispatchEvent({type:"tick",remaining:a.timeout-a.time,completion:parseFloat(a.time/a.timeout)});this.lastTick=new Date()}};FF.Timer.prototype.reset=function(){this.time=0;this.lastTick=new Date();this.dispatchEvent({type:"timeout"});if(this.autostart){this.restart()}else{this.active=false}};FF.Timer.prototype.restart=function(){var a=this;this.time=0;this.lastTick=new Date();this.dispatchEvent({type:"start",timeout:a.timeout});this.active=true};FF.Timer.prototype.getRemainingTime=function(){return this.timeout-this.time};FF.Viewport=function(a){this.x=0;this.y=0;this.max_x=a.max_x||FF.Render.width;this.max_y=a.max_y||FF.Render.height;this.width=a.width||FF.Render.width;this.height=a.height||FF.Render.height;this.moving=false};FF.Viewport.prototype.move=function(a,b){this.x+=a||0;this.y+=b||0;this.verifyPosition()};FF.Viewport.prototype.moveTo=function(a,b){this.x=a||this.x;this.y=b||this.y;this.verifyPosition()};FF.Viewport.prototype.isInside=function(a){return(a.x>=this.x&&a.x<=(this.x+this.width)&&a.y>=this.y&&a.y<=(this.y+this.height))};FF.Viewport.prototype.isOutside=function(a){return !this.isInside(a)};FF.Viewport.prototype.isPartlyInside=function(b){var a=b.rect();a.right=a.x+a.width;a.bottom=a.y+a.height;return a.right>=this.x&&a.x<=(this.x+this.width)&&a.bottom>=this.y&&b.y<=(this.y+this.height)};FF.Viewport.prototype.isLeftOf=function(a){return a.x<this.x};FF.Viewport.prototype.isRightOf=function(a){return a.x>this.x+this.width};FF.Viewport.prototype.isAbove=function(a){return a.y<this.y};FF.Viewport.prototype.isBelow=function(a){return a.y>this.y+this.height};FF.Viewport.prototype.centerAround=function(a){this.x=Math.floor(a.x-this.width/2);this.y=Math.floor(a.y-this.height/2);this.verifyPosition()};FF.Viewport.prototype.forceInsideVisibleArea=function(b,a){if(b.x<this.x+a){b.x=this.x+a}if(b.x>this.x+FF.Render.Context.width-a){b.x=this.x+FF.Render.Context.width-a}if(b.y<this.y+a){b.y=this.y+a}if(b.y>this.y+FF.Render.Context.height-a){b.y=this.y+FF.Render.Context.height-a}};FF.Viewport.prototype.forceInside=function(b,a){if(b.x<a){b.x=a}if(b.x>this.max_x-a){b.x=this.max_x-a}if(b.y<a){b.y=a}if(b.y>this.max_y-a){b.y=this.max_y-a}};FF.Viewport.prototype.apply=function(a){FF.Render.save();FF.Render.translate(-this.x,-this.y);a();FF.Render.restore()};FF.Viewport.prototype.draw=function(c,a,d){var b=this;this.apply(function(){if(c.draw){b.drawIfPartlyInside(c,a,d)}})};FF.Viewport.prototype.drawIfPartlyInside=function(item,draw_fctn,draw_fctn_arg){if(this.isPartlyInside(item)){if(draw_fctn){eval("item."+draw_fctn+'("'+draw_fctn_arg+'");')}else{item.draw()}}};FF.Viewport.prototype.verifyPosition=function(){var b=0;var a=this.max_x-this.width;if(this.x<0){this.x=0}else{b++}if(this.x>a){this.x=a}else{b++}var a=this.max_y-this.height;if(this.y<0){this.y=0}else{b++}if(this.y>a){this.y=a}else{b++}if(b>2){this.moving=true}else{this.moving=false}};FF.Viewport.prototype.rect=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};FF.WebSocketServer=function(a,b){FF.EventManager.call(this);this.session_data=b;this.url=a};FF.WebSocketServer.prototype.query=function(a,c){var b=this;var d={fn:a,fn_master:a,ID:b.session_data.ID,SID:b.session_data.SID,content:c};this.socket.send(JSON.stringify(d))};FF.WebSocketServer.prototype.onopen=function(a){this.sendAccountingRequest();this.dispatchEvent({type:"start"})};FF.WebSocketServer.prototype.onerror=function(a){};FF.WebSocketServer.prototype.onclose=function(a){console.log(a)};FF.WebSocketServer.prototype.onmessage=function(a){this.dispatchEvent({type:"message",msg:JSON.parse(a.data)})};FF.WebSocketServer.prototype.sendAccountingRequest=function(){var a=this;this.query("accounting_start",{sessionData:a.session_data})};FF.WebSocketServer.prototype.start=function(){var a=this;this.socket=new WebSocket(this.url);this.socket.onopen=function(b){a.onopen(b)};this.socket.onmessage=function(b){a.onmessage(b)};this.socket.onerror=function(b){a.onerror(b)};this.socket.onclose=function(b){a.onclose(b)}};